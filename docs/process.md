# 検討過程

## サマリ
- pix2pix ベースでフォント補完を行う実装を採用。
- 学習データは参考フォントとターゲットフォントのペア画像。
- モデルは U-Net ジェネレータと PatchGAN 識別器で構成。
- 今後はより深いモデルやストローク一貫性を考慮した損失導入を検討。


## 検討過程記録

このファイルには本リポジトリの実装方針を検討した内容を簡単に記録します。

### PR #4
1. 参考フォントと既存フォントのペア画像を作成することで pix2pix 形式の学習が可能と判断。
2. モデルは U-Net ジェネレータと PatchGAN 識別器を採用し、実装をシンプルに保つ。
3. 学習では GAN 損失に加えて L1 損失を大きめに掛けることで画素の一致度を高める。
4. 生成した PNG からフォントデータへ変換する手順も検討し、FontForge などの自動トレースを想定。

今後はモデルの改良やデータ拡張などを試し、品質向上を目指す予定です。

### PR #6
1. 文字リストとフォントパスから学習用画像を自動生成する機能を追加。
2. 推論時に一時ファイルを使わずメモリ上で画像を処理するよう改善。
3. ドキュメントを更新し、学習・推論フローを整理。

### PR #7
1. 2 段階学習とデータ増強に対応するため `stagewise_train` を実装。
2. 画像前処理としてランダムアフィン変換、ノイズ付与、太さ変化を選択可能にした。
3. ドキュメントを整理し、学習戦略を `training_strategy.md` として追加。

### PR #8
1. Perceptual Loss と層凍結を追加し、2 段階学習の忘却を軽減。
2. データ増強を参考フォントとターゲットで別々に適用できるよう改善。
3. 高解像度学習のメリットと注意点を `high_resolution.md` に整理。

### PR #9
1. ドキュメントの誤記を修正し、データセット変換の仕様を整理。
2. ヘッダのメタ情報を更新。

### PR #10
1. 512px 学習へ拡張するため画像サイズと U-Net 段数をパラメータ化。
2. `torch.cuda.amp` を用いて混合精度学習に対応。
3. データセットに個別 Transform とリサイズ処理を追加し、リハーサル戦略を強化。
4. ドキュメントを更新し、高解像度学習の手順を追記。

### PR #11
1. VGG Perceptual Loss を多層化し、PSNR/SSIM の定量評価を追加。
2. `CosineAnnealingLR` による学習率スケジュールを導入。
3. これらに合わせてドキュメントを整理し、学習戦略へ定量評価の章を追記。

### PR #12
1. SciPy を利用した太さシフト変換をデータ増強に追加。
2. InstanceNorm と BatchNorm を切り替え可能にし、スタイル保持を改善。
3. ドキュメントを追補し、実装の選択肢を明確化。

### PR #13
1. `log_memory` で GPU メモリ使用量を記録できるよう改良。
2. YAML 形式の設定ファイルを読み込む `train_from_config` を追加。
3. ドキュメントにデータセットバランスとベクトル化の注意点を追記。

### PR #14
1. 環境構築手順をまとめた `installation.md` を新設し、`index.md` からリンクを追加。
2. 既存ドキュメントを整理して導入までの流れを明確化。
3. 256px 事前学習と 512px プログレッシブ学習を自動化する `train_pix2pix_pro.py` を追加。
4. ドキュメントを整理し、新スクリプトの使用方法を追記。

### PR #15
1. `train_pix2pix_pro.py` の初期設定を整理し、フォントパスを `fonts/` 配下に統一。
2. コード機能の概要をまとめた `docs/code_overview.md` を追加し、`index.md` から参照できるようにした。
3. スクリプトのドックストリングでバージョン情報を更新。
